name: Publish to TestFlight
description: Uploads an IPA file to TestFlight using App Store Connect API.

inputs:
  file:
    description: The path to the IPA file to be uploaded to TestFlight.
    required: true
  api-key:
    description: The base64-encoded App Store Connect API private key (.p8 file).
    required: true
  api-key-id:
    description: The App Store Connect API Key ID.
    required: true
  api-issuer-id:
    description: The App Store Connect API Issuer ID.
    required: true
  release-notes:
    description: Notes for this release to be displayed to testers in TestFlight.
    required: false
  tester-groups:
    description: A comma-separated list of internal tester group names to distribute the build to.
    required: false

runs:
  using: composite
  steps:
    - name: ðŸš€ Upload to TestFlight
      shell: bash
      run: |
        chmod +x "${{ github.action_path }}/scripts/upload_testflight.sh"
        "${{ github.action_path }}/scripts/upload_testflight.sh" \
        "${{ inputs.file }}" \
        "${{ inputs.api-key }}" \
        "${{ inputs.api-key-id }}" \
        "${{ inputs.api-issuer-id }}" \
        "${{ inputs.release-notes }}" \
        "${{ inputs.tester-groups }}"