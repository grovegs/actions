name: Generate Changelog
description: Generate a changelog between two Git tags.

inputs:
  latest-version:
    description: The latest version tag to compare (e.g., 1.0.0).
    required: true
  next-version:
    description: The next version tag to compare (e.g., 1.1.0).
    required: true

outputs:
  changelog:
    description: The generated changelog between the latest tag and the latest commit.
    value: ${{ steps.generate_changelog.outputs.changelog }}

runs:
  using: composite
  steps:
    - name: ⚙️ Generate Changelog
      id: generate_changelog
      shell: bash
      run: |
        chmod +x "${{ github.action_path }}/scripts/generate_changelog.sh"
        changelog=$("${{ github.action_path }}/scripts/generate_changelog.sh" "${{ inputs.latest-version }}" "${{ inputs.next-version }}")

        escaped_changelog=""
        while IFS= read -r line; do
          escaped_changelog+=$(echo "$line" | sed 's/%/%25/g; s/\n/%0A/g; s/\r/%0D/g')"%0A"
        done <<< "$changelog"

        echo "changelog=${escaped_changelog}" >> "$GITHUB_OUTPUT"
