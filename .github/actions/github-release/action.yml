name: GitHub Release
description: Creates a GitHub release and uploads specified artifacts.

inputs:
  title:
    description: The title for the GitHub release.
    required: true
  version:
    description: The version number for the release.
    required: true
  github-token:
    description: The GitHub token for authentication.
    required: true

runs:
  using: composite
  steps:
    - name: üì• Download artifacts
      uses: actions/download-artifact@v4
      with:
        path: ./artifacts
        merge-multiple: true

    - name: üîñ Create Tag and Push
      shell: bash
      run: |
        git config user.name GitHub Actions
        git config user.email actions@github.com
        git tag ${{ inputs.version }}
        git push origin ${{ inputs.version }}

    - name: üìù Create GitHub Release
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github-token }}
      run: |
        if [[ -d "./artifacts" ]]; then
          echo "Listing files in artifacts:"
          ls -l ./artifacts
        else
          echo "Artifacts directory does not exist."
          exit 1
        fi

        FILES=$(find ./artifacts -type f | xargs)
        echo "Files to be attached to release: $FILES"

        if [[ -z "$FILES" ]]; then
          echo "No files found to upload."
          exit 1
        fi

        if [[ ${{ inputs.version }} != 0.0.0 ]]; then
          gh release create ${{ inputs.version }} $FILES \
            --title ${{ inputs.title }} --generate-notes --notes-start-tag ${{ inputs.version }}
        else
          gh release create ${{ inputs.version }} $FILES \
            --title ${{ inputs.title }}
        fi
