name: Setup Godot
description: Downloads, installs, and caches Godot for the specified platform.

inputs:
  global-json-file:
    description: Path to the `global.json` file to extract the Godot version.
    required: true
  path:
    description: Path to the `global.json` file to extract the Godot version.
    required: false
    default: ~/.godot

runs:
  using: composite
  steps:
    - name: üìñ Read Godot version
      id: read_version
      shell: bash
      run: |
        chmod +x "${{ github.action_path }}/scripts/read_version.sh"
        version=$("${{ github.action_path }}/scripts/read_version.sh" "${{ inputs.global-json-file }}")
        echo version="$version" >> "$GITHUB_OUTPUT"

    - name: ‚¨áÔ∏è Download Godot
      id: download_godot
      #if: steps.cache_godot.outputs.cache-hit != 'true'
      shell: bash
      run: |
        chmod +x "${{ github.action_path }}/scripts/download_godot.sh"
        file=$("${{ github.action_path }}/scripts/download_godot.sh" "${{ steps.read_version.outputs.version }}" "${{ inputs.path }}" "${{ runner.os }}")
        echo file="$file" >> "$GITHUB_OUTPUT"

    - name: ‚öôÔ∏è Install Godot
      id: install_godot
      #if: steps.cache_godot.outputs.cache-hit != 'true'
      shell: bash
      run: |
        chmod +x "${{ github.action_path }}/scripts/install_godot.sh"
        "${{ github.action_path }}/scripts/install_godot.sh" "${{ steps.download_godot.outputs.file }}"

    - name: üîó Link Godot Command
      shell: bash
      run: |
        chmod +x "${{ github.action_path }}/scripts/link_godot.sh"
        "${{ github.action_path }}/scripts/link_godot.sh" "${{ steps.read_version.outputs.version }}" "${{ inputs.path }}" "${{ runner.os }}"
