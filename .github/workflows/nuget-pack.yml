name: Nuget Pack

on:
  workflow_call:
    inputs:
      id:
        required: true
        type: string
      version:
        required: true
        type: string
      platform:
        required: false
        type: string

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      ARTIFACT_DIR: ./artifacts

    steps:
      - name: ğŸ”— Set Dynamic Paths
        run: |
          echo "ARTIFACT_NAME=$(echo '${{ inputs.id }}' | sed -E 's/([a-z])([A-Z])/\1-\2/g' | tr '[:upper:]' '[:lower:]')-${{ inputs.version }}${{ format('-{0}', inputs.platform) || '' }}" >> $GITHUB_ENV
          echo "ARTIFACT=$ARTIFACT_DIR/$ARTIFACT_NAME.nupkg" >> $GITHUB_ENV

      - name: ğŸ“¥ Download Build Artifacts
        uses: actions/download-artifact@v4
        with:
          name: dotnet-project${{ format('-{0}', inputs.platform) || '' }}
          path: $ARTIFACT_DIR

      - name: ğŸ“¦ Pack NuGet Package
        run: dotnet pack --no-build --configuration Release /p:PackageVersion=${{ inputs.version }} $ARTIFACT_DIR

      - name: âœï¸ Rename NuGet Package
        run: |
          mv $ARTIFACT_DIR/package/release/${{ inputs.id }}.${{ inputs.version }}.nupkg $ARTIFACT

      - name: ğŸ“¤ Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: nuget-package${{ format('-{0}', inputs.platform) || '' }}
          path: $ARTIFACT
