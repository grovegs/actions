name: Github Release

on:
  workflow_call:
    inputs:
      title:
        required: true
        type: string
      version:
        required: true
        type: string
      artifacts:
        required: true
        type: string

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Download Artifacts
        run: |
          IFS=',' read -ra ARTIFACT_NAMES <<< "${{ inputs.artifacts }}"
          for ARTIFACT_NAME in "${ARTIFACT_NAMES[@]}"; do
            actions/download-artifact@v4 --name "$ARTIFACT_NAME" --path "./artifacts/$ARTIFACT_NAME"
          done

      - name: 🔖 Create Tag and Push
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git tag "${{ inputs.version }}"
          git push origin "${{ inputs.version }}"

      - name: 📝 Create GitHub Release
        run: |
          ASSET_FILES=$(find ./artifacts -type f)

          if [[ "${{ inputs.version }}" != "0.0.0" ]]; then
            gh release create ${{ inputs.version }} $ASSET_FILES \
              --title "${{ inputs.title }}" --generate-notes --notes-start-tag "${{ inputs.version }}"
          else
            gh release create ${{ inputs.version }} $ASSET_FILES \
              --title "${{ inputs.title }}"
          fi
