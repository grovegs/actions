name: ğŸ§ª Tests

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

permissions:
  contents: read

jobs:
  test-dotnet-actions:
    name: Test .NET Actions
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup .NET
        uses: ./.github/actions/setup-dotnet
        with:
          global-json-file: sandbox/ConsoleApp/global.json

      - name: ğŸ§ª Test .NET Project
        uses: ./.github/actions/test-dotnet
        with:
          project: sandbox/ConsoleApp/ConsoleApp.csproj

      - name: ğŸ¨ Format .NET Project
        uses: ./.github/actions/format-dotnet
        with:
          project: sandbox/ConsoleApp/ConsoleApp.csproj

      - name: ğŸ—ï¸ Build .NET Project
        uses: ./.github/actions/build-dotnet
        with:
          project: sandbox/ConsoleApp/ConsoleApp.csproj
          version: 1.0.0-test

      - name: ğŸ“¦ Pack .NET Project
        uses: ./.github/actions/pack-dotnet
        with:
          project: sandbox/ConsoleApp/ConsoleApp.csproj
          version: 1.0.0-test

  test-godot-actions:
    name: Test Godot Actions
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ® Setup Godot
        uses: ./.github/actions/setup-godot
        with:
          global-json-file: sandbox/GodotApplication/global.json

      - name: ğŸ§ª Test Godot Project
        uses: ./.github/actions/test-godot
        with:
          project: sandbox/GodotApplication
          global-json-file: sandbox/GodotApplication/global.json

  test-unity-actions:
    name: Test Unity Actions
    runs-on: macos-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ® Setup Unity
        uses: ./.github/actions/setup-unity
        with:
          project: sandbox/UnityApplication
          unity-version: 2023.3.0f1
          unity-modules: android

  test-android-setup:
    name: Test Android Setup
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ¤– Setup Android
        uses: ./.github/actions/setup-android
        with:
          java-version: 17
          android-packages: platform-tools platforms;android-34

  test-xcode-setup:
    name: Test Xcode Setup
    runs-on: macos-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ Setup Xcode
        uses: ./.github/actions/setup-xcode
        with:
          xcode-version: 15.4

  test-utility-actions:
    name: Test Utility Actions
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ†™ Bump Version
        id: bump_version
        uses: ./.github/actions/bump-version
        with:
          version-type: patch

      - name: ğŸ“ Generate Changelog
        uses: ./.github/actions/generate-changelog
        with:
          next-version: ${{ steps.bump_version.outputs.next-version }}

  test-package-actions:
    name: Test Package Actions
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Pack Godot Addon
        uses: ./.github/actions/pack-godot-addon
        with:
          addon: sandbox/GodotApplication/addons/test_addon
          version: 1.0.0-test

      - name: ğŸ“¦ Pack Unity Package
        uses: ./.github/actions/pack-unity-package
        with:
          package: sandbox/UnityApplication/Packages/com.grovegames.test
          version: 1.0.0-test
