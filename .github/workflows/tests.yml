name: ğŸ§ª Tests

on:
    push:
        branches:
            - main
            - develop
    pull_request:
        branches:
            - main
            - develop

permissions:
    contents: read

jobs:
    test-dotnet-actions:
        name: Test .NET Actions
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ”§ Setup .NET
              uses: ./.github/actions/setup-dotnet
              with:
                  global-json-file: sandbox/ConsoleApp/global.json

            - name: ğŸ§ª Test .NET Project
              uses: ./.github/actions/test-dotnet
              with:
                  project: sandbox/ConsoleApp
                  configuration: Debug

            - name: ğŸ¨ Format .NET Project
              uses: ./.github/actions/format-dotnet
              with:
                  project: sandbox/ConsoleApp

            - name: ğŸ—ï¸ Build .NET Project
              uses: ./.github/actions/build-dotnet
              with:
                  project: sandbox/ConsoleApp
                  configuration: Release
                  version: 1.0.0-test
                  define-symbols: TEST_BUILD

            - name: ğŸ“¦ Pack .NET Project
              uses: ./.github/actions/pack-dotnet
              with:
                  project: sandbox/ConsoleApp
                  configuration: Release
                  version: 1.0.0-test
                  filename: ConsoleApp-test

    test-godot-actions:
        name: Test Godot Actions
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ”§ Setup .NET
              uses: ./.github/actions/setup-dotnet
              with:
                  global-json-file: sandbox/GodotApplication/global.json

            - name: ğŸ® Setup Godot
              uses: ./.github/actions/setup-godot
              with:
                  global-json-file: sandbox/GodotApplication/global.json
                  target-platforms: Android
                  cache: true

            - name: ğŸ§ª Test Godot Project
              uses: ./.github/actions/test-godot
              with:
                  project: sandbox/GodotApplication
                  global-json-file: sandbox/GodotApplication/global.json

    test-unity-actions:
        name: Test Unity Actions
        runs-on: macos-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ¤– Setup Android
              uses: ./.github/actions/setup-android
              with:
                  java-version: 17
                  android-packages: "platform-tools platforms;android-34 build-tools;34.0.0 ndk;25.1.8937393"

            - name: ğŸ® Setup Unity
              uses: ./.github/actions/setup-unity
              with:
                  project: sandbox/UnityApplication
                  unity-modules: android
                  cache: true

    test-android-setup:
        name: Test Android Setup
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ¤– Setup Android
              uses: ./.github/actions/setup-android
              with:
                  java-version: 17
                  android-packages: "platform-tools platforms;android-34 build-tools;34.0.0"

    test-xcode-setup:
        name: Test Xcode Setup
        runs-on: macos-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ Setup Xcode
              uses: ./.github/actions/setup-xcode
              with:
                  xcode-version: "16.2"

    test-utility-actions:
        name: Test Utility Actions
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5
              with:
                  fetch-depth: 0

            - name: ğŸ†™ Bump Version
              id: bump_version
              uses: ./.github/actions/bump-version
              with:
                  version-type: patch

            - name: ğŸ“ Generate Changelog
              uses: ./.github/actions/generate-changelog
              with:
                  next-version: ${{ steps.bump_version.outputs.next-version }}

    test-package-actions:
        name: Test Package Actions
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ“¦ Pack Godot Addon
              uses: ./.github/actions/pack-godot-addon
              with:
                  addon: sandbox/GodotApplication/addons/TestAddon
                  version: 1.0.0-test
                  filename: TestAddon-test

    test-format-actions:
        name: Test Format Actions
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸ”§ Setup .NET
              uses: ./.github/actions/setup-dotnet
              with:
                  global-json-file: sandbox/ConsoleApp/global.json

            - name: ğŸ¨ Test Format Files Action
              uses: ./.github/actions/format-files
              with:
                  files: "**/*.{yml,yaml,json,md,sh}"
                  ignore-path: ".gitignore"

            - name: ğŸ¨ Test Format .NET Action
              uses: ./.github/actions/format-dotnet
              with:
                  project: sandbox/ConsoleApp
